From efc3c82552ec009a20252ed3e412aff3ef983fa2 Mon Sep 17 00:00:00 2001
From: Lonnie Abelbeck <lonnie@abelbeck.com>
Date: Mon, 28 Jul 2014 08:19:47 -0500
Subject: [PATCH] fixed: Move NAT_LOCAL_REDIRECT to be applied before the drop
 logs, Issue #13

---
 bin/arno-iptables-firewall | 14 +++++++-------
 1 file changed, 7 insertions(+), 7 deletions(-)

diff --git a/bin/arno-iptables-firewall b/bin/arno-iptables-firewall
index 0f74051..1e52ec8 100755
--- a/bin/arno-iptables-firewall
+++ b/bin/arno-iptables-firewall
@@ -3373,6 +3373,13 @@ setup_ext_input_chain()
     ip6tables -A EXT_INPUT_CHAIN -d ff00::/8 -j EXT_MULTICAST_CHAIN
   fi
 
+  # Allow all packets that have been locally redirected
+  #####################################################
+  if [ "$NAT_LOCAL_REDIRECT" = "1" ]; then
+    echo " Enabling support for NAT local redirect"
+    ip4tables -A EXT_INPUT_CHAIN -m conntrack --ctstate DNAT -j ACCEPT
+  fi
+
   # Log packets to privileged TCP ports?
   ##################################################
   if [ "$PRIV_TCP_LOG" != "0" ]; then
@@ -3439,13 +3446,6 @@ setup_ext_input_chain()
     echo " Logging of IPv4 IGMP packets disabled"
   fi
 
-  # Allow all packets that have been locally redirected
-  #####################################################
-  if [ "$NAT_LOCAL_REDIRECT" = "1" ]; then
-    echo " Enabling support for NAT local redirect"
-    ip4tables -A EXT_INPUT_CHAIN -m conntrack --ctstate DNAT -j ACCEPT
-  fi
-
   # Finally drop all in the broadcast chain
   iptables -A EXT_BROADCAST_CHAIN -j DROP
     
-- 
2.0.3
